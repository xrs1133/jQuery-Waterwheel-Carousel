/*!
 * Waterwheel Carousel
 * Version 2.2.0
 * http://www.bkosborne.com
 *
 * Copyright 2011-2013 Brian Osborne
 * Dual licensed under GPLv3 or MIT
 * Copies of the licenses have been distributed
 * with this plugin.
 *
 * Plugin written by Brian Osborne
 * for use with the jQuery JavaScript Framework
 * http://www.jquery.com
 */(function(e){"use strict";e.fn.waterwheelCarousel=function(t){function s(){i={itemsContainer:e(n),itemSelector:n.selector+"-item",totalItems:o(e(n)).length,containerWidth:e(n).width(),containerHeight:e(n).height(),currentCenterItem:null,previousCenterItem:null,items:[],calculations:[],carouselRotationsLeft:0,currentlyMoving:!1,itemsAnimating:0,currentSpeed:r.speed,intervalTimer:null,currentDirection:"forward",leftItemsCount:0,rightItemsCount:0,performingSetup:!0};r.carouselItemContent=="div"?e(i.itemSelector).removeClass(r.activeClassName):i.itemsContainer.find("img").removeClass(r.activeClassName)}function o(t){return r.carouselItemContent=="div"?e(t).children():e(t).find("img")}function u(t){return r.carouselItemContent=="div"?e(t+" img"):t}function a(e){clearTimeout(i.autoPlayTimer);!e&&r.autoPlay!==0&&(i.autoPlayTimer=setTimeout(function(){r.autoPlay>0?E("forward"):E("backward")},Math.abs(r.autoPlay)))}function f(t){if(r.preloadImages===!1){t();return}var n=o(i.itemsContainer),s=0,u=n.length;n.each(function(){if(r.carouselItemContent=="div")var n=e(this).children(".item-content").children("img");else var n=e(this);n.bind("load",function(){s+=1;if(s===u){t();return}});n.attr("src",n.attr("src"));this.complete&&n.trigger("load")})}function l(){o(i.itemsContainer).each(function(){(e(this).data("original_width")==undefined||r.forcedImageWidth>0)&&e(this).data("original_width",e(this).width());(e(this).data("original_height")==undefined||r.forcedImageHeight>0)&&e(this).data("original_height",e(this).height())})}function c(){r.forcedImageWidth&&r.forcedImageHeight&&o(i.itemsContainer).each(function(){e(this).width(r.forcedImageWidth);e(this).height(r.forcedImageHeight)})}function h(){if(r.carouselItemContent=="div")var e=o(i.itemsContainer).first();else var e=i.itemsContainer.find("img:first");i.calculations[0]={distance:0,offset:0,opacity:1};var t=r.horizonOffset,n=r.separation;for(var s=1;s<=r.flankingItems+2;s++){if(s>1){t*=r.horizonOffsetMultiplier;n*=r.separationMultiplier}i.calculations[s]={distance:i.calculations[s-1].distance+n,offset:i.calculations[s-1].offset+t,opacity:i.calculations[s-1].opacity*r.opacityMultiplier}}r.edgeFadeEnabled?i.calculations[r.flankingItems+1].opacity=0:i.calculations[r.flankingItems+1]={distance:0,offset:0,opacity:0}}function p(){i.items=o(i.itemsContainer);for(var t=0;t<i.totalItems;t++)i.items[t]=e(i.items[t]);r.horizon===0&&(r.orientation==="horizontal"?r.horizon=i.containerHeight/2:r.horizon=i.containerWidth/2);if(r.carouselItemContent=="div")var n=i.itemsContainer.css("position","relative").children();else var n=i.itemsContainer.css("position","relative").find("img");n.each(function(){var t,n;if(r.orientation==="horizontal"){t=i.containerWidth/2-e(this).data("original_width")/2;n=r.horizon-e(this).data("original_height")/2}else{t=r.horizon-e(this).data("original_width")/2;n=i.containerHeight/2-e(this).data("original_height")/2}e(this).css({left:t,top:n,visibility:"visible",position:"absolute","z-index":0,opacity:0}).data({top:n,left:t,oldPosition:0,currentPosition:0,depth:0,opacity:0}).show()})}function d(){r.startingItem=r.startingItem===0?Math.round(i.totalItems/2):r.startingItem;i.rightItemsCount=Math.ceil((i.totalItems-1)/2);i.leftItemsCount=Math.floor((i.totalItems-1)/2);i.carouselRotationsLeft=1;m(i.items[r.startingItem-1],0);i.items[r.startingItem-1].css("opacity",1);var e=r.startingItem-1;for(var t=1;t<=i.rightItemsCount;t++){e<i.totalItems-1?e+=1:e=0;i.items[e].css("opacity",1);m(i.items[e],t)}var e=r.startingItem-1;for(var t=-1;t>=i.leftItemsCount*-1;t--){e>0?e-=1:e=i.totalItems-1;i.items[e].css("opacity",1);m(i.items[e],t)}}function v(e,t){var n=Math.abs(t);if(n<r.flankingItems+1)var s=i.calculations[n];else var s=i.calculations[r.flankingItems+1];if(r.singleSizeDifference)if(n>1)var o=Math.pow(r.sizeMultiplier,1);else var o=Math.pow(r.sizeMultiplier,n);else var o=Math.pow(r.sizeMultiplier,n);var u=o*e.data("original_width"),a=o*e.data("original_height"),f=Math.abs(e.width()-u),l=Math.abs(e.height()-a),c=s.offset,h=s.distance;t<0&&(h*=-1);if(r.orientation=="horizontal")var p=i.containerWidth/2,d=p+h-u/2,v=r.horizon-c-a/2;else var p=i.containerHeight/2,d=r.horizon-c-u/2,v=p+h-a/2;var m;t===0?m=1:m=s.opacity;var g=r.flankingItems+2-n;e.data("width",u);e.data("height",a);e.data("top",v);e.data("left",d);e.data("oldPosition",e.data("currentPosition"));e.data("depth",g);e.data("opacity",m)}function m(e,t){if(Math.abs(t)<=r.flankingItems+1){v(e,t);i.itemsAnimating++;e.css("z-index",e.data().depth).animate({left:e.data().left,width:e.data().width,height:e.data().height,top:e.data().top,opacity:e.data().opacity},i.currentSpeed,r.animationEasing,function(){g(e,t)})}else{e.data("currentPosition",t);e.data("oldPosition")===0&&e.css({left:e.data().left,width:e.data().width,height:e.data().height,top:e.data().top,opacity:e.data().opacity,"z-index":e.data().depth})}}function g(e,t){i.itemsAnimating--;e.data("currentPosition",t);t===0&&(i.currentCenterItem=e);if(i.itemsAnimating===0){i.carouselRotationsLeft-=1;i.currentlyMoving=!1;if(i.carouselRotationsLeft>0)y(0);else{i.currentSpeed=r.speed;i.currentCenterItem.addClass(r.activeClassName);if(i.performingSetup===!1){r.movedToCenter(i.currentCenterItem);r.movedFromCenter(i.previousCenterItem)}i.performingSetup=!1;a()}}}function y(t){if(i.currentlyMoving===!1){i.currentCenterItem.removeClass(r.activeClassName);i.currentlyMoving=!0;i.itemsAnimating=0;i.carouselRotationsLeft+=t;if(r.quickerForFurther===!0){t>1&&(i.currentSpeed=r.speed/t);i.currentSpeed=i.currentSpeed<100?100:i.currentSpeed}for(var n=0;n<i.totalItems;n++){var s=e(i.items[n]),o=s.data("currentPosition"),u;i.currentDirection=="forward"?u=o-1:u=o+1;var a=u>0?i.rightItemsCount:i.leftItemsCount;if(Math.abs(u)>a){u=o*-1;i.totalItems%2==0&&(u+=1)}m(s,u)}}}function b(){var e=i.currentCenterItem.next();e.length<=0&&(e=i.currentCenterItem.parent().children().first());return e}function w(){var e=i.currentCenterItem.prev();e.length<=0&&(e=i.currentCenterItem.parent().children().last());return e}function E(e){if(i.currentlyMoving===!1){i.previousCenterItem=i.currentCenterItem;r.movingFromCenter(i.currentCenterItem);if(e=="backward"){r.movingToCenter(w());i.currentDirection="backward"}else if(e=="forward"){r.movingToCenter(b());i.currentDirection="forward"}}y(1)}if(this.length>1){this.each(function(){e(this).waterwheelCarousel(t)});return this}var n=this,r={},i={};e(this).children().bind("click",function(){var t=e(this).data().currentPosition;if(Math.abs(t)>=r.flankingItems+1)return;if(i.currentlyMoving)return;i.previousCenterItem=i.currentCenterItem;a(!0);r.autoPlay=0;var n=Math.abs(t);if(t==0)r.clickedCenter(e(this));else{r.movingFromCenter(i.currentCenterItem);r.movingToCenter(e(this));if(t<0){i.currentDirection="backward";y(n)}else if(t>0){i.currentDirection="forward";y(n)}}});e(this).find("a").bind("click",function(t){var n=e(this).find("img").data("currentPosition")==0;if(r.linkHandling===1||r.linkHandling===2&&!n){t.preventDefault();return!1}});e(document).keydown(function(e){if(r.keyboardNav){if(e.which===37&&r.orientation=="horizontal"||e.which===38&&r.orientation=="vertical"){a(!0);r.autoPlay=0;E("backward")}else if(e.which===39&&r.orientation=="horizontal"||e.which===40&&r.orientation=="vertical"){a(!0);r.autoPlay=0;E("forward")}if(r.keyboardNavOverride&&(r.orientation=="horizontal"&&(e.which===37||e.which===39)||r.orientation=="vertical"&&(e.which===38||e.which===40))){e.preventDefault();return!1}}});this.reload=function(t){if(typeof t=="object")var n=t;else var n={};r=e.extend({},e.fn.waterwheelCarousel.defaults,t);s();o(i.itemsContainer).hide();c();f(function(){l();h();p();d()})};this.next=function(){a(!0);r.autoPlay=0;E("forward")};this.prev=function(){a(!0);r.autoPlay=0;E("backward")};this.reload(t);return this};e.fn.waterwheelCarousel.defaults={startingItem:1,separation:175,separationMultiplier:.6,horizonOffset:0,horizonOffsetMultiplier:1,sizeMultiplier:.7,opacityMultiplier:.8,horizon:0,flankingItems:3,speed:300,animationEasing:"linear",quickerForFurther:!0,edgeFadeEnabled:!1,linkHandling:2,autoPlay:0,orientation:"horizontal",activeClassName:"carousel-center",keyboardNav:!1,keyboardNavOverride:!0,preloadImages:!0,forcedImageWidth:0,forcedImageHeight:0,movingToCenter:e.noop,movedToCenter:e.noop,clickedCenter:e.noop,movingFromCenter:e.noop,movedFromCenter:e.noop,singleSizeDifference:!1,itemContent:"img"}})(jQuery);